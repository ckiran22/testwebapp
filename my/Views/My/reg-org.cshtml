@{
  ViewBag.Title = "Home";
}
@using Enzigma.Platform.Objects;
@using Enzigma.Platform;

@model Enzigma.Platform.Web.UI.PlatformPageContext

<form name="formOrg" ng-app="RegisterOrg" ng-controller="RegisterOrgController" class="pure-form pure-form-stacked">
    <div id="error"></div>
    <fieldset>
        <legend>{{layout.sections[0].Label}}</legend>
        <div class="pure-g-r">
            <div class="pure-u-1-5" ng-repeat="f in layout.sections[0].Fields">
                <label for="{{f.Name}}">{{f.Name}}</label>
                <input id="{{f.Name}}" type="text" placeholder="{{f.Name}}" ng-model="org[f.Name]" />
            </div>
    </fieldset>

    <fieldset>
        <legend>{{layout.sections[1].Label}}</legend>
        <div class="pure-g-r">
            <div class="pure-u-1-5" ng-repeat="f in layout.sections[1].Fields">
                  <label for="{{f.Name}}">{{f.Name}}</label>
                <input id="{{f.Name}}" type="text" placeholder="{{f.Name}}" ng-model="user[f.Name]" />
            </div>
    </fieldset>

    <button type="button" ng-click="registerOrg()" class="pure-button pure-button-primary pure-u-input">Submit</button>
</form>


<script lang="javascript">
    var RegisterOrg = angular.module('RegisterOrg', []);
    RegisterOrg.controller('RegisterOrgController', ['$scope', function ($scope) {
        $scope.org = { ObjType: 'Organization', Name: 'Enzigma Software Pvt. Ltd.', Email: 'test@enzigma.com', Phone1: '111-111-1111', Address1: 'Baner Road', Address2: 'Opp D-Mart', Country: 'India', State: 'MH', City: 'Pune', PostalCode: '411045' };
        $scope.user = { ObjType: 'User', Email: 'sunil.aware@enzigma.com', Username: 'test@enzigma.com', FirstName: 'Sunil', LastName: 'Aware' };
        $scope.test = "sunil.aware@enzigma.com";
        $scope.registerOrg = function () {
            if ($scope.formOrg.$valid) {
                var action = { action: 'Create', data: { org: $scope.org, user: $scope.user, SendEmail: true } };
                Engine.post('http://localhost/admin/api/org', action);
            }
        }
        $scope.layout = {
            sections: [
      {
          Label: 'Organization Information',
          Fields: [
          { Name: 'Name' },
          { Name: 'Email' },
          { Name: 'Phone1' },
          { Name: 'Address1' },
          { Name: 'Address2' },
          { Name: 'Country' },
          { Name: 'State' },
          { Name: 'City' },
          { Name: 'PostalCode' }]
      },
      {
          Label: 'Primary User Information',
          Fields: [
          { Name: 'FirstName' },
          { Name: 'LastName' },
          { Name: 'Username' },
          { Name: 'Email' }]
      }
            ]
        };
    }]);
</script>
